(self.webpackChunktiny_files=self.webpackChunktiny_files||[]).push([[662],{3662:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>p});var r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"tiny-explore"}},[s("h1",{staticClass:"title"},[t._v("tiny-files explorer")]),t._v(" "),t.paths?s("tiny-explorer",{attrs:{paths:t.paths,mapLink:t.getLink,rootRoute:"/explore",rootName:t.rootName,viewOnly:""},on:{"update:dir":function(e){t.dir=e},open:t.open}}):t._e(),t._v(" "),s("b-loading",{attrs:{active:t.working}})],1)};r._withStripped=!0;var i=s(6222),o=s.n(i),a=s(9461),h=s(7853),n=s(4357);const l=s(7670).Z.component("tiny-explore",{data(){const t={working:!1,paths:null,rawPaths:[],rootPath:"",dir:"/",store:"",user:"",share:"",getLink:e=>h.Z.files.getPublicReadUrl(t.user,(t.rootPath+e).slice("/public".length),t.store)};return t},computed:{rootName(){return this.user+"@"+this.store.replace(/^.+?:\/\//,"")+this.rootPath}},async mounted(){this.$route.query.store&&this.$route.query.user&&this.$route.query.share||this.$router.replace("/"),this.store=""+this.$route.query.store,this.user=""+this.$route.query.user,this.share=""+this.$route.query.share,await this.refresh()},methods:{async refresh(){if(this.working)return;this.working=!0;const t="/public".length;if(this.rawPaths=await o().get(`${this.store}/public/${this.user}${a.Z.publicScope.slice(t)}/shares/${this.share}.json`).then((t=>t.data.entries),(t=>((0,n.S3)(t),[]))),!this.rawPaths.length)return console.warn("no paths!"),this.paths=[],void(this.working=!1);const e=await o().post(`${this.store}/public-info/${this.user}`,this.rawPaths.map((e=>e.slice(t)))).then((t=>t.data),(t=>((0,n.S3)(t),{})));Object.keys(e).length!==this.rawPaths.length&&(console.warn("some entries are missing!"),this.rawPaths=Object.keys(e)),this.rootPath=(0,n.Ic)(this.rawPaths);const s=[];for(const r of this.rawPaths)s.push(Object.assign({name:r.slice(r.lastIndexOf("/")+1),type:"none",size:0,modified:0},e[r.slice(t)],{path:r.slice(this.rootPath.length)}));this.paths=s,this.working=!1},open(t){window.open(this.getLink(t),"__blank")}}});var u=(0,s(1900).Z)(l,r,[],!1,null,null,null);u.options.__file="src/pages/explore/explore.vue";const p=u.exports}}]);